title: "Preprocess T1-weighted MRI" # Short name for the pipeline referenced in the UI
schema_version: 1.0 # the version of the specification format used for this file
version:
  # Define a version for the pipeline in combination of the underlying package version (e.g. FSL)
  # and the "build" of the pipeline
  package: "1.0"
  build: "1"
base_image:
  # Chose a NeuroDesk FSL container as the base
  name: deepmi/fastsurfer
  package_manager: apt # It is not obvious from the base image what the package manager is
  tag: gpu-v2.2.0
packages:
  # Install dependencies for DICOM->NIfTI conversion
  pip:
    pydra-mrtrix3: 3.0.4a5
    pydra-fsl:
    fileformats:
    pydra-fastsurfer:
    fileformats-medimage-extras:
    fileformats-medimage-mrtrix3: 3.0.4a5
    australianimagingservice-community-au-edu-sydney-sydneyimaging:
    # For fastsurfer
    # absl-py: 2.0.0
    # cachetools: 5.3.2
    # certifi: 2023.7.22
    # charset-normalizer: 3.3.2
    # click: # 8.1.7
    # cmake: 3.27.7
    # contourpy: 1.2.0
    # cycler: 0.12.1
    # deprecated: 1.2.14
    # filelock: # 3.13.1
    # fonttools: 4.44.3
    # google-auth: 2.23.4
    # google-auth-oauthlib: 1.0.0
    # grpcio: 1.59.2
    # h5py: 3.7.0
    # humanize: 4.8.0
    # idna: 3.4
    # imageio: 2.32.0
    # jinja2: 3.1.2
    # joblib: 1.3.2
    # kiwisolver: 1.4.5
    # lapy: 1.0.1
    # lit: 17.0.5
    # markdown: 3.5.1
    # markupsafe: 2.1.3
    # matplotlib: 3.7.1
    # mpmath: 1.3.0
    # networkx: 3.2.1
    # nibabel: 5.1.0
    # numpy: 1.25.0
    # oauthlib: 3.2.2
    # packaging: 23.2
    # pandas: 1.5.3
    # pillow: 10.0.1
    # plotly: 5.18.0
    # protobuf: 4.25.1
    # psutil: 5.9.6
    # pyasn1: 0.5.0
    # pyasn1-modules: 0.3.0
    # pyparsing: 3.1.1
    # python-dateutil: 2.8.2
    # pytz: 2023.3.post1
    # pywavelets: 1.4.1
    # pyyaml: # 6.0
    # requests: # 2.31.0
    # requests-oauthlib: # 1.3.1
    # rsa: 4.9
    # scikit-image: 0.19.3
    # scikit-learn: 1.2.2
    # scipy: # 1.10.1
    # simpleitk: 2.2.1
    # six: 1.16.0
    # sympy: 1.12
    # tenacity: 8.2.3
    # tensorboard: 2.12.1
    # tensorboard-data-server: 0.7.2
    # tensorboard-plugin-wit: 1.8.1
    # threadpoolctl: 3.2.0
    # tifffile: 2023.9.26
    # torch: 2.0.1+cu117
    # torchio: 0.18.83
    # torchvision: 0.15.2+cu117
    # tqdm: 4.65.0
    # triton: 2.0.0
    # typing-extensions: # 4.8.0
    # urllib3: 2.1.0
    # werkzeug: 3.0.1
    # wheel: 0.41.3
    # wrapt: 1.16.0
    # yacs: 0.1.8
  neurodocker:
    mrtrix3: 3.0.2
    fsl: 6.0.5.1
authors:
  # Authors of the pipeline. The first email will be considered to be the maintainer of
  # the generated container images
  - name: Arkiev D'Souza
    email: arkiev.dsouza@sydney.edu.au
  - name: Thomas G. Close
    email: thomas.close@sydney.edu.au
licenses:
  freesurfer:
    destination: /opt/freesurfer/license.txt
    info_url: https://surfer.nmr.mgh.harvard.edu/registration.html
    description: >
      FastSurfer, which is used to perform segmentation and surface recon, requires a FreeSurfer license to run.
docs:
  info_url: "https://placeholder.org" # Link to external documentation for underlying tool
  description: | # Description of tool for auto-docs
    Generate a 5TT image (HSVS) and parcellation image (Desikan, Destrieux, HCPMMP1, Yeo7 and Yeo17) from a single input anatomical image. Input image should satisfy the input requirements for FastSurfer
command:
  task: australianimagingservice.community.au.edu.sydney.sydneyimaging.t1_preproc:t1_processing_pipeline # Use the generic "shell-cmd" task
  row_frequency: session # the pipeline is desgined to run on imaging "sessions" as opposed to "subjects" or "projects"
  inputs: # List the inputs that are presented to end-user in UI
    t1w:
      datatype: medimage/nifti-gz # MIME-type or "MIME-like" format
      help: "T1-weighted anatomical scan" # description of field presented in U
      column_defaults:
        datatype: medimage/nifti-gz # medimage/dicom-series  # the default
  outputs: # List the outputs generated by the pipeline
    parcellation:
      field: parc_image
      datatype: medimage-mrtrix3/image-format # MIME-type or "MIME-like" format
      help: parcellation image generated # description of field presented in UI
    vis_image_fsl:
      field: vis_image_fsl
      datatype: medimage-mrtrix3/image-format-gz # MIME-type or "MIME-like" format
      help: 5ttvis image FSL # description of field presented in UI
    ftt_image_fsl:
      field: ftt_image_fsl
      datatype: medimage-mrtrix3/image-format-gz # MIME-type or "MIME-like" format
      help: 5tt image FSL # description of field presented in UI
    vis_image_freesurfer:
      field: vis_image_freesurfer
      datatype: medimage-mrtrix3/image-format-gz # MIME-type or "MIME-like" format
      help: 5ttvis image FreeSurfer # description of field presented in UI
    ftt_image_freesurfer:
      field: ftt_image_freesurfer
      datatype: medimage-mrtrix3/image-format-gz # MIME-type or "MIME-like" format
      help: 5tt image FreeSurfer # description of field presented in UI
    vis_image_hsvs:
      field: vis_image_hsvs
      datatype: medimage-mrtrix3/image-format-gz # MIME-type or "MIME-like" format
      help: 5ttvis image HSVS # description of field presented in UI
    ftt_image_hsvs:
      field: ftt_image_hsvs
      datatype: medimage-mrtrix3/image-format-gz # MIME-type or "MIME-like" format
      help: 5tt image HSVS # description of field presented in UI

  #     5TThsvs:
  #       datatype: medimage-mrtrix3/image-format-gz  # MIME-type or "MIME-like" format
  #       help:  5-tissue-type image suitable for ACT generated using HSVS algorithm # description of field presented in UI
  #     5TThsvs_vis:
  #       datatype: medimage-mrtrix3/image-format-gz  # MIME-type or "MIME-like" format
  #       help:  image for visualisation purposes from an ACT 5TT segmented anatomical image  # description of field presented in UI
  #     parcellation_desikan:
  #       datatype: medimage-mrtrix3/image-format-gz  # MIME-type or "MIME-like" format
  #       help: parcellation image generated using Desikan atlas  # description of field presented in UI
  #     parcellation_desikan:
  #       datatype: medimage-mrtrix3/image-format-gz  # MIME-type or "MIME-like" format
  #       help: parcellation image generated using Desikan atlas
  #     parcellation_destrieux:
  #       datatype: medimage-mrtrix3/image-format-gz  # MIME-type or "MIME-like" format
  #       help: parcellation image generated using Destrieux atlas
  #     parcellation_hcpmmp1:
  #       datatype: medimage-mrtrix3/image-format-gz  # MIME-type or "MIME-like" format
  #       help: parcellation image generated using HCPMMP1 atlas
  #     parcellation_Yeo7:
  #       datatype: medimage-mrtrix3/image-format-gz  # MIME-type or "MIME-like" format
  #       help: parcellation image generated using Yeo7 atlas
  #     parcellation_Yeo17:
  #       datatype: medimage-mrtrix3/image-format-gz  # MIME-type or "MIME-like" format
  #       help: parcellation image generated using Yeo17 atlas
  #     FastSurfer_dir:
  #       datatype: generic/directory
  #       help: contents of FastSurfer outputs
  parameters:
    parcellation:
      datatype: field/text # Format of the field
      help: parcellation type # description of field presented in UI
      default: desikan # Default value, filled in on the UI
  configuration: # Additional args passed to arcana.common:shell_cmd
    mrtrix_lut_dir: /opt/mrtrix3-3.0.2/share/mrtrix3/labelconvert
    fs_license: /opt/freesurfer/license.txt
    freesurfer_home: /opt/freesurfer
    cache_dir: /work/pydra-cache
    fastsurfer_executable:
      - /fastsurfer/Docker/entrypoint.sh
      - /fastsurfer/run_fastsurfer.sh
      - --allow_root
